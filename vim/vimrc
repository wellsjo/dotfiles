"
" Editor Settings
"

set nocompatible
set nobackup
set nowritebackup
set noswapfile

filetype plugin on

" Indenting
set autoindent
set smartindent
filetype indent on

" Search
set ignorecase " Case-insensitive search
set smartcase  " Case-sensitive search when using caps
set incsearch  " Show match while typing pattern
set hlsearch   " Highlight search results

if has("mouse")
  set mouse=a
endif

set ttymouse=sgr

" Undo
set undolevels=1000
set undoreload=1000
if !isdirectory(expand("~/.vim/.undo/"))
  silent !mkdir -p ~/.vim/.undo
endif
set undodir^=~/.vim/.undo//
set undofile

call plug#begin('~/.vim/plugged')

"
" Language Support
"

" Golang
Plug 'govim/govim'

" ======= Plugins ======

Plug 'vim-scripts/AfterColors.vim'          " customize color schemes
Plug 'ConradIrwin/vim-bracketed-paste'      " better copy-paste in insert mode
Plug 'wesQ3/vim-windowswap'                 " swap windows

" Typescript
Plug 'Quramy/tsuquyomi'
Plug 'leafgarland/typescript-vim'
let g:tsuquyomi_completion_detail = 1
let g:tsuquyomi_disable_quickfix = 1

Plug 'ruanyl/vim-sort-imports'
Plug 'gabrielelana/vim-markdown'

" Nerd Tree (filesystem)
Plug 'scrooloose/nerdtree'                  " file explorer (nerd tree)
Plug 'jistr/vim-nerdtree-tabs'              " persistent nerd tree

Plug 'jlanzarotta/bufexplorer'              " buffer exploring
nnoremap B :ToggleBufExplorer<Cr>
let g:bufExplorerSortBy='mru'

" Not related to bufexplorer, but this is how we switch buffers
Plug 'mildred/vim-bufmru'
nnoremap <tab> :BufMRUNext<CR>
noremap <S-tab> :BufMRUPrev<CR>

" Status bar
Plug 'vim-airline/vim-airline'
Plug 'vim-airline/vim-airline-themes'
let g:airline_theme='bubblegum'
if !exists('g:airline_symbols')
  let g:airline_symbols = {}
endif
let g:airline_left_sep = '»'
let g:airline_left_sep = ''
let g:airline_right_sep = '«'
let g:airline_right_sep = ''
let g:airline_symbols.linenr = '␊'
let g:airline_symbols.linenr = '␤'
let g:airline_symbols.linenr = '¶'
let g:airline_symbols.branch = '⎇'
let g:airline_symbols.paste = 'ρ'
let g:airline_symbols.paste = 'Þ'
let g:airline_symbols.paste = '∥'
let g:airline_symbols.whitespace = 'Ξ'

" Tabs format
Plug 'gcmt/taboo.vim'
let g:taboo_modified_tab_flag="+"
let g:taboo_tab_format=' %N. %f %m '

" fzf
Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' }
Plug 'junegunn/fzf.vim'
nnoremap <c-t> :FZF<cr>

Plug 'mhinz/vim-startify'                   " start screen
Plug 'DataWraith/auto_mkdir'                " mkdir -p for creating files

" Linting / fixing
Plug 'w0rp/ale', { 'for': ['javascript', 'typescript'] }
" Plug 'valloric/youcompleteme'

" MRU (recently opened files)
Plug 'vim-scripts/mru.vim'
let MRU_File = $HOME . '/.vim_mru_files'
let MRU_Window_Height = 15
nnoremap mr :MRU<cr>

Plug 'easymotion/vim-easymotion'
Plug 'jiangmiao/auto-pairs'                 " auto pair brakcets, parens, quotes

" Better scrolling
Plug 'terryma/vim-smooth-scroll'
nnoremap <CR> :call smooth_scroll#down(25, 20, 2)<cr>
nnoremap <silent> <c-d> :call smooth_scroll#down(15, 20, 2)<cr>
nnoremap <silent> <c-u> :call smooth_scroll#up(15, 20, 2)<cr>

" Git
Plug 'tpope/vim-fugitive'
Plug 'airblade/vim-gitgutter'

" Requires local config, used for gitlab access token
Plug 'shumphrey/fugitive-gitlab.vim'
if !empty(glob("~/.local.vim"))
  source $HOME/.local.vim
endif

Plug 'ntpeters/vim-better-whitespace'       " whitespace handler
highlight ExtraWhitespace ctermbg=red

Plug 'tpope/vim-surround'                   " surround words with characters
Plug 'tpope/vim-commentary'                 " easily comment out code
Plug 'tpope/vim-repeat'                     " better repeat (.)
Plug 'wellsjo/vim-save-cursor-position'     " Save cursor position when you exit files

" Languages
Plug 'pangloss/vim-javascript'
Plug 'mxw/vim-jsx'
Plug 'hashivim/vim-terraform'
Plug 'jparise/vim-graphql'
Plug 'gf3/peg.vim'
Plug 'chr4/nginx.vim'

Plug 'prettier/vim-prettier', {
  \ 'do': 'yarn install',
  \ 'for': ['javascript', 'typescript', 'css', 'less', 'scss', 'json', 'graphql', 'markdown', 'vue'] }

Plug 'wellsjo/wellsokai.vim'
Plug 'endel/vim-github-colorscheme'

call plug#end()

" NERD Tree
nnoremap \ :NERDTreeTabsToggle<Cr>
nnoremap \| :NERDTreeFind<Cr>
let NERDTreeShowHidden=0
let NERDTreeCascadeSingleChildDir=0

" Golang
" if has("patch-8.1.1904")
set completeopt+=popup
set completepopup=align:menu,border:off,highlight:Pmenu
" endif

" Short updatetime time in order that govim/Vim are more responsive/IDE-like
set updatetime=500

" To make govim/Vim more responsive/IDE-like, we suggest a short balloondelay
set balloondelay=250

" Suggestion: Turn on the sign column so you can see error marks on lines
" where there are quickfix errors. Some users who already show line number
" might prefer to instead have the signs shown in the number column; in which
" set signcolumn=number
set signcolumn=yes

" Color Schemes
colorscheme wellsokai
set background=dark
" set background=light

" =============================================================================

if has("mac")
  set shortmess+=c                    " Getsrid of annoying error messages
endif
set showcmd                         " Show the command as you type

" Colors, syntax
set number                          " Show number lines
let t_Co=256
let mapleader=" "
let g:netrw_dirhistmax = 0
set term=screen-256color

" editing, tabs, indenting
set expandtab                       " Tab key creates spaces
set smarttab
set cindent
set tabstop=2                       " Number of space for tab character
set softtabstop=2                   " Number of spaces in tab when editing
set shiftwidth=2                    " Number of spaces used for >>, <<, ==
set backspace=2                     " Best backspace setting
scriptencoding utf-8
set encoding=utf-8

" status bar
set laststatus=2
set nocursorcolumn

" Enables resizing vim panes from tmux
" if &term =~ '^screen'
"   set ttymouse=xterm2
" endif

" Search and highlight words under cursor (toggle)
imap <c-f> <c-x><c-f>
nnoremap <c-f> :let @/='\<<C-R>=expand("<cword>")<CR>\>'<CR>:set hls!<CR>

" Toggle highlighting
imap <c-h> <c-x><c-h>
nnoremap <c-h> :set hlsearch!<CR>

" Easy motion
map <Leader> <Plug>(easymotion-prefix)

" Fast quit
nnoremap <leader>q :q<CR>

" Quick write
nnoremap <leader>f :w<CR>

" Quick way to format a file
nnoremap <leader>g gg=G''zz

" Save while in insert mode with 'jj'
inoremap jj <esc>:w<CR>

" Stop editing in place with 'jk'
inoremap jk <esc>:<cr><right>

" Quickly switch tabs
nnoremap gr gT

" Arrow keys to resize windows
nnoremap <Left> :vertical resize +5<CR>
nnoremap <Right> :vertical resize -5<CR>
nnoremap <Up> :resize +5<CR>
nnoremap <Down> :resize -5<CR>

" Auto-center search results
nnoremap n nzz
nnoremap N Nzz

" Move vertically by visual line
nnoremap j gj
nnoremap k gk

" Move windiws with j, k, o, p
map <silent> <C-o> :wincmd h<CR>
map <silent> <C-p> :wincmd l<CR>
map <silent> <C-j> :wincmd j<CR>
map <silent> <C-k> :wincmd k<CR>

" Yank line without newline character
nmap yu yg$

" worp/ale
let g:ale_fix_on_save = 1
let g:ale_lint_on_save = 1
let g:ale_lint_on_enter = 1
let g:ale_fixers = {
\   'javascript': ['prettier'],
\   'typescript': ['prettier', 'tslint']
\}
let g:ale_linters = {
\   'javascript': ['flow'],
\}

" Better mapping for repeating macros
map , @

" Search and replace word under cursor
nnoremap s :%s/\<<C-r><C-w>\>/

" Go def in new tab
autocmd FileType typescript nmap <silent> gd :TsuDefinition<CR>
" this also works in python?

" ======= Plugin Settings =======

" vim-javascript
" Enable syntax highlighting for JSDoc comments
let g:javascript_plugin_jsdoc = 1
